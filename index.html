<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Briefings - Tabela/Cards</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    /* Switch minimal style */
    .form-switch .form-check-input {
      width: 3em; 
      margin-left: -2.5em;
    }
    /* Botões prateados (btn-secondary) e branco (btn-light) quando selecionados */
    .btn-check + .btn {
      position: relative; 
      min-width: 2.5rem;
    }
    .btn-check:checked + .btn {
      background-color: #f8f9fa !important; /* .btn-light */
      border-color: #f8f9fa !important; 
      color: #212529 !important; 
    }
    .btn-check:checked + .btn::before {
      content: "✔";
      color: #000; 
      position: absolute; 
      left: 0.5rem; 
      top: 0.3rem;
    }
    .table-step-btn {
      height: 3rem; 
      flex-wrap: nowrap; 
      margin-right: 0.25rem; 
    }
    .btn-group.flex-nowrap {
      flex-wrap: nowrap !important;
    }
    /* 
      Classes FORÇANDO a cor de fundo
      para cada estado, igual ao Card:
        0 => cinza
        1 => amarelo
        2 => azul
        3 => verde
      Com !important, não será sobrescrito.
    */
    .bg-step-0 {
      background-color: #6c757d !important; /* ~ bg-secondary */
      color: #fff !important;
    }
    .bg-step-1 {
      background-color: #ffc107 !important; /* ~ bg-warning */
      color: #212529 !important;
    }
    .bg-step-2 {
      background-color: #0d6efd !important; /* ~ bg-primary */
      color: #fff !important;
    }
    .bg-step-3 {
      background-color: #198754 !important; /* ~ bg-success */
      color: #fff !important;
    }
    /* Adicione isto ao seu CSS */
.bg-step-0, 
.bg-step-0 td {
  background-color: #6c757d !important;
}
.bg-step-1, 
.bg-step-1 td {
  background-color: #ffc107 !important;
}
.bg-step-2, 
.bg-step-2 td {
  background-color: #0d6efd !important;
}
.bg-step-3, 
.bg-step-3 td {
  background-color: #198754 !important;
}
        .card .btn-group .btn {
      margin: 3px 0;
    }
  </style>
</head>
<body class="bg-light">
<div class="container mt-5">
  <h2 class="mb-4">Briefings Agendados</h2>
  <div class="d-flex align-items-center mb-3">
    <div class="form-check form-switch me-3">
      <input class="form-check-input" type="checkbox" id="toggleView">
      <label class="form-check-label" for="toggleView">Tabela</label>
    </div>
    <div class="form-check form-switch" id="toggleCompactContainer" style="display:none">
      <input class="form-check-input" type="checkbox" id="toggleCompact">
      <label class="form-check-label" for="toggleCompact">Compacto</label>
    </div>
  </div>
  <div id="briefingArea"></div>
</div>

<script>
const STEP_LABELS = ["Solicitado","Verificado Auxiliar","Verificado Previsor","Enviado"];
const scheduledBriefings = [
  {
    origem:"SBPS", rota:"SBPS -> SBSV", destino:"SBSV", nivelVoo:"220",
    etd:"2025-03-30T09:00", eta:"2025-03-30T10:10", horaEntrega:"2025-03-29T18:00",
    tipoAeronave:"Asa Fixa",
    observacoes:"Condições de teto e visibilidade na serra.",
    maxStep:0
  },
  {
    origem:"SBKP", rota:"SBKP -> SBBR", destino:"SBBR", nivelVoo:"350",
    etd:"2025-04-01T06:30", eta:"2025-04-01T08:15", horaEntrega:"2025-03-31T22:30",
    tipoAeronave:"Asa Móvel",
    observacoes:"Informar variação de vento cruzado em rota.",
    maxStep:1
  },
  {
    origem:"SBMO", rota:"SBMO -> SBRF", destino:"SBRF", nivelVoo:"280",
    etd:"2025-04-02T13:50", eta:"2025-04-02T15:20", horaEntrega:"2025-04-01T23:00",
    tipoAeronave:"Asa Fixa",
    observacoes:"Favor verificar formação de CB próximo à costa.",
    maxStep:2
  },
  {
    origem:"SBGL", rota:"SBGL -> SBNF", destino:"SBNF", nivelVoo:"320",
    etd:"2025-04-05T07:00", eta:"2025-04-05T08:40", horaEntrega:"2025-04-04T21:00",
    tipoAeronave:"Asa Móvel",
    observacoes:"Possível névoa matinal. Necessito de detalhes de RVR.",
    maxStep:3
  }
];

let tableView = false, compactMode = false;

/* Em vez de classes Bootstrap, usamos as classes .bg-step-* acima */
function rowOrCardBgClass(m){
  switch(m){
    case 0: return "bg-step-0";
    case 1: return "bg-step-1";
    case 2: return "bg-step-2";
    case 3: return "bg-step-3";
    default: return "bg-light text-dark";
  }
}

function getStepLabel(i){ return STEP_LABELS[i] || "?"; }

function toggleStep(idx,i){
  let c = scheduledBriefings[idx].maxStep;
  if(i > c) c = i;
  else if(i === c) c = Math.max(0, i-1);
  else c = i;
  scheduledBriefings[idx].maxStep = c;
  renderView();
}

function renderStepButtons(idx, maxS, isTable){
  const g = document.createElement("div");
  g.role = "group";
  g.className = isTable ? "btn-group flex-nowrap" : "btn-group d-flex flex-wrap";
  for(let i=0; i<STEP_LABELS.length; i++){
    const inp = document.createElement("input");
    inp.type = "checkbox";
    inp.className = "btn-check";
    inp.id = `btn-${idx}-${i}`;
    inp.checked = (i <= maxS);
    inp.addEventListener("change", ()=>toggleStep(idx,i));

    const lbl = document.createElement("label");
    lbl.className = "btn btn-secondary me-1"; 
    if(isTable){
      lbl.classList.add("table-step-btn");
      lbl.title = STEP_LABELS[i];
      lbl.textContent = ""; // texto vazio na tabela
    } else {
      lbl.textContent = STEP_LABELS[i];
    }
    lbl.htmlFor = `btn-${idx}-${i}`;

    g.appendChild(inp);
    g.appendChild(lbl);
  }
  return g;
}

function renderCards(container){
  const row = document.createElement("div");
  row.className = "row";
  scheduledBriefings.forEach((b, idx)=>{
    const col = document.createElement("div");
    col.className = "col-sm-12 col-md-6 col-lg-4 mb-3";

    const card = document.createElement("div");
    /* Aplica .bg-step-* no card */
    card.className = `card h-100 ${rowOrCardBgClass(b.maxStep)}`;

    const cb = document.createElement("div");
    cb.className = "card-body";

    const t = document.createElement("h4");
    t.className = "card-title fw-bold text-uppercase mb-3";
    t.textContent = `Briefing: ${b.origem} → ${b.destino}`;
    cb.appendChild(t);

    if(!compactMode){
      const sub = document.createElement("h6");
      sub.className = "card-subtitle mb-2";
      sub.textContent = `Rota: ${b.rota}`;
      cb.appendChild(sub);

      const nv = document.createElement("p");
      nv.textContent = `Nível: FL${b.nivelVoo}`;
      cb.appendChild(nv);

      const ta = document.createElement("p");
      ta.textContent = `Tipo: ${b.tipoAeronave}`;
      cb.appendChild(ta);

      const e1 = document.createElement("p");
      e1.textContent = `ETD: ${b.etd.replace("T"," ")}Z`;
      cb.appendChild(e1);

      const e2 = document.createElement("p");
      e2.textContent = `ETA: ${b.eta.replace("T"," ")}Z`;
      cb.appendChild(e2);

      const en = document.createElement("p");
      en.textContent = `Entrega: ${b.horaEntrega.replace("T"," ")}Z`;
      cb.appendChild(en);
    }
    const o = document.createElement("p");
    o.textContent = `Obs: ${b.observacoes}`;
    cb.appendChild(o);

    const st = document.createElement("p");
    st.innerHTML = `<strong>Passo:</strong> ${getStepLabel(b.maxStep)}`;
    cb.appendChild(st);

    cb.appendChild(renderStepButtons(idx,b.maxStep,false));
    card.appendChild(cb);
    col.appendChild(card);
    row.appendChild(col);
  });
  container.appendChild(row);
}

function renderTable(container){
  const tbl = document.createElement("table");
  tbl.className = "table table-bordered";

  const th = document.createElement("thead");
  th.innerHTML = `<tr>
    <th>Origem</th>
    <th>Rota</th>
    <th>Destino</th>
    <th>Nível</th>
    <th>ETD</th>
    <th>ETA</th>
    <th>Entrega</th>
    <th>Aeronave</th>
    <th>Obs</th>
    <th>Passo</th>
    <th></th>
  </tr>`;
  const tb = document.createElement("tbody");

  scheduledBriefings.forEach((b, idx)=>{
    const tr = document.createElement("tr");
    /* Aplica a mesma cor de fundo do card */
    tr.className = rowOrCardBgClass(b.maxStep);

    const tdO = document.createElement("td");
    tdO.textContent = b.origem;
    tr.appendChild(tdO);

    const tdR = document.createElement("td");
    tdR.textContent = b.rota;
    tr.appendChild(tdR);

    const tdD = document.createElement("td");
    tdD.textContent = b.destino;
    tr.appendChild(tdD);

    const tdN = document.createElement("td");
    tdN.textContent = `FL${b.nivelVoo}`;
    tr.appendChild(tdN);

    const tdE1 = document.createElement("td");
    tdE1.textContent = `${b.etd.replace("T"," ")}Z`;
    tr.appendChild(tdE1);

    const tdE2 = document.createElement("td");
    tdE2.textContent = `${b.eta.replace("T"," ")}Z`;
    tr.appendChild(tdE2);

    const tdEn = document.createElement("td");
    tdEn.textContent = `${b.horaEntrega.replace("T"," ")}Z`;
    tr.appendChild(tdEn);

    const tdT = document.createElement("td");
    tdT.textContent = b.tipoAeronave;
    tr.appendChild(tdT);

    const tdObs = document.createElement("td");
    tdObs.textContent = b.observacoes;
    tr.appendChild(tdObs);

    const tdSt = document.createElement("td");
    tdSt.textContent = getStepLabel(b.maxStep);
    tr.appendChild(tdSt);

    const tdBtns = document.createElement("td");
    tdBtns.appendChild(renderStepButtons(idx,b.maxStep,true));
    tr.appendChild(tdBtns);

    tb.appendChild(tr);
  });

  tbl.appendChild(th);
  tbl.appendChild(tb);
  container.appendChild(tbl);
}

function renderView(){
  const c = document.getElementById("briefingArea");
  c.innerHTML = "";
  document.getElementById("toggleCompactContainer").style.display = (tableView?"none":"block");
  if(!tableView) renderCards(c);
  else renderTable(c);
}

const toggleView = document.getElementById("toggleView");
toggleView.addEventListener("change",()=>{
  tableView = toggleView.checked;
  renderView();
});

const toggleCompact = document.getElementById("toggleCompact");
toggleCompact.addEventListener("change",()=>{
  compactMode = toggleCompact.checked;
  renderView();
});

renderView();
</script>
</body>
</html>
